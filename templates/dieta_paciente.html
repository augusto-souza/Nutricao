{% extends 'base.html' %}

{% block content %}

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="mb-0">Plano Alimentar</h2>
        <p class="text-muted">Paciente: <strong>{{ paciente.first_name }} {{ paciente.last_name }}</strong> ({{ paciente.username }})</p>
    </div>
    
    <div>
        <a href="{% url 'lista_pacientes' %}" class="btn btn-outline-secondary me-2">
            <i class="bi bi-arrow-left"></i> Voltar para Lista
        </a>
        <a href="{% url 'adicionar_alimento_paciente' paciente.id %}" class="btn btn-success">
            <i class="bi bi-plus-lg"></i> Adicionar Alimento
        </a>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-3">
        <div class="card card-custom bg-primary text-white mb-3">
            <div class="card-body">
                <h5 class="card-title">Calorias</h5>
                <p class="card-text display-6">{{ total_calorias }} kcal</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card card-custom bg-danger text-white mb-3">
            <div class="card-body">
                <h5 class="card-title">Proteínas</h5>
                <p class="card-text display-6">{{ total_proteinas }}g</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card card-custom bg-warning text-dark mb-3">
            <div class="card-body">
                <h5 class="card-title">Carboidratos</h5>
                <p class="card-text display-6">{{ total_carboidratos }}g</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card card-custom bg-info text-white mb-3">
            <div class="card-body">
                <h5 class="card-title">Gorduras</h5>
                <p class="card-text display-6">{{ total_gorduras }}g</p>
            </div>
        </div>
    </div>
</div>

<div class="card card-custom">
    <div class="card-header bg-white">
        <h4 class="mb-0">Histórico de Alimentos</h4>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover align-middle">
                <thead>
                    <tr>
                        <th>Alimento</th>
                        <th>Calorias</th>
                        <th>Prot (g)</th>
                        <th>Carb (g)</th>
                        <th>Gord (g)</th>
                        <th>Data</th>
                        
                        {% if is_nutricionista %}
                            <th class="text-end">Ações</th> 
                        {% endif %}
                    </tr>
                </thead>
                
                <tbody>
                    {% for alimento in alimentos %}
                    <tr>
                        <td>{{ alimento.nome }}</td>
                        <td>{{ alimento.calorias }}</td>
                        <td>{{ alimento.proteinas }}</td>
                        <td>{{ alimento.carboidratos }}</td>
                        <td>{{ alimento.gorduras }}</td>
                        <td>{{ alimento.data_consumo|date:"d/m/Y" }}</td>
                        
                        {% if is_nutricionista %}
                        <td class="text-end">
                            <a href="{% url 'editar_alimento' alimento.id %}" class="btn btn-sm btn-warning" title="Editar">
                                Editar
                            </a>
                            <a href="{% url 'deletar_alimento' alimento.id %}" class="btn btn-sm btn-danger" title="Excluir">
                                Excluir
                            </a>
                        </td>
                        {% endif %}
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="{% if is_nutricionista %}7{% else %}6{% endif %}" class="text-center text-muted py-4">
                            Nenhum alimento registrado para este paciente ainda.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}